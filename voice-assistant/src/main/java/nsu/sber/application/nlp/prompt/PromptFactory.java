package nsu.sber.application.nlp.prompt;

public class PromptFactory {

    public static String BuildPromptForInvalidAddItem(String menu) {
        return String.format(
                "Пользователь хочет добавить блюдо в корзину. " +
                        "Сопоставь текст пользователя с блюдами из меню и выбери точное блюдо и размер, если он указан.\n\n" +
                        "Меню:\n%s\n\n" +
                        "Твоя задача:\n" +
                        "1. Найди блюдо, которое написал пользователь.\n" +
                        "2. Определи itemId этого блюда.\n" +
                        "3. Определи sizeId выбранного размера. Если размер не указан или не найден, верни null.\n\n" +
                        "Ответ должен быть ТОЛЬКО в JSON формате, без пояснений, без текста, без примечаний.\n" +
                        "Структура JSON:\n" +
                        "{\n" +
                        "  \"itemId\": \"string или null\",\n" +
                        "  \"sizeId\": \"string или null\"\n" +
                        "}\n\n" +
                        "Пример:\n" +
                        "{\n" +
                        "  \"itemId\": \"568134e2-883e-4668-82e2-3dde9fb28bf4\",\n" +
                        "  \"sizeId\": \"16034385-a22b-47c7-8c43-bba2696b65c6\"\n" +
                        "}\n\n" +
                        "Если блюдо не найдено, верни null для itemId.\n" +
                        "Если размер не найден или не указан, верни null для sizeId.\n",
                menu
        );
    }

    public static String BuildPromptForInvalidRemoveItem(String menu) {
        return String.format(
                "Пользователь хочет удалить блюдо из корзины. " +
                        "Проанализируй текст пользователя и сопоставь его с блюдами из меню, чтобы определить itemId и sizeId.\n\n" +
                        "Меню:\n%s\n\n" +
                        "Твоя задача:\n" +
                        "1. Найди блюдо, которое написал пользователь.\n" +
                        "2. Определи itemId этого блюда.\n" +
                        "3. Определи sizeId выбранного размера. Если размер не указан или не найден, верни null.\n\n" +
                        "Ответ должен быть ТОЛЬКО в JSON формате, без текста, без пояснений.\n" +
                        "Структура JSON:\n" +
                        "{\n" +
                        "  \"itemId\": \"string или null\",\n" +
                        "  \"sizeId\": \"string или null\"\n" +
                        "}\n\n" +
                        "Пример:\n" +
                        "{\n" +
                        "  \"itemId\": \"568134e2-883e-4668-82e2-3dde9fb28bf4\",\n" +
                        "  \"sizeId\": \"16034385-a22b-47c7-8c43-bba2696b65c6\"\n" +
                        "}\n\n" +
                        "Если блюдо не найдено, верни null для itemId.\n" +
                        "Если размер не найден или не указан, верни null для sizeId.\n",
                menu
        );
    }

    public static String BuildPromptMappingCommand() {
        return String.format(
                "Ты — интеллектуальный помощник официанта в ресторане.\n" +
                        "Твоя задача — анализировать текст пользователя и преобразовывать его в список **структурированных команд** для backend-системы ресторана.\n" +
                        "\n" +
                        "Отвечай **строго в формате JSON**, без пояснений, без текста, без примеров.\n" +
                        "\n" +
                        "### Формат ответа:\n" +
                        "{\n" +
                        "  \"commands\": [\n" +
                        "    {\n" +
                        "      \"type\": \"одно из допустимых значений IntentType\",\n" +
                        "      \"parameters\": { \"параметры команды\" }\n" +
                        "    }\n" +
                        "  ]\n" +
                        "}\n" +
                        "\n" +
                        "### Допустимые типы команд (IntentType):\n" +
                        "\"add_item\", \"remove_item\", \"change_quantity\", \"show_cart\",\n" +
                        "\"call_waiter\", \"pay\", \"confirm\", \"cancel\", \"help\", \"unknown\", \"get_menu_list\"\n" +
                        "\n" +
                        "### Правила:\n" +
                        "* Если пользователь формулирует несколько действий, верни несколько объектов в массиве \"commands\".\n" +
                        "* Если из контекста неясно, что делать, используй \"type\": \"unknown\".\n" +
                        "* Поле \"parameters\" всегда объект JSON. Если нет параметров, используй {}.\n" +
                        "* Не добавляй поясняющий текст, только **валидный JSON**.\n" +
                        "\n" +
                        "### Пример:\n" +
                        "Пользователь: \"Добавь пиццу и покажи корзину\"\n" +
                        "Ответ:\n" +
                        "{\n" +
                        "  \"commands\": [\n" +
                        "    {\"type\": \"add_item\", \"parameters\": {\"name\": \"пицца\"}},\n" +
                        "    {\"type\": \"show_cart\", \"parameters\": {}}\n" +
                        "  ]\n" +
                        "}\n"
        );
    }

    public static String buildPromptForDishRecognition(String menu, String userText) {
        return """
        Пользователь хочет получить подробную информацию о блюде.
        Определи, какое именно блюдо имеется в виду, используя меню.

        Меню:
        %s

        Текст пользователя:
        "%s"

        Твоя задача:
        1. Найди блюдо, наиболее соответствующее запросу пользователя.
        2. Верни только JSON в формате:
        {
          "itemId": "string или null"
        }

        Если блюдо не найдено — верни:
        {
          "itemId": null
        }

        Никаких пояснений, примечаний и текста — только JSON.
        """.formatted(menu, userText);
    }

}
