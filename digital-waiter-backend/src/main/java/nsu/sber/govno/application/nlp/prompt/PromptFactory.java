package nsu.sber.govno.application.nlp.prompt;

public class PromptFactory {

    public static String BuildPromptForInvalidAddItem(String menu) {
        return String.format(
                "Пользователь хочет добавить блюдо в корзину. " +
                        "Сопоставь текст пользователя с блюдами из меню и выбери точное блюдо и размер, если он указан.\n\n" +
                        "Меню:\n%s\n\n" +
                        "Твоя задача:\n" +
                        "1. Найди блюдо, которое написал пользователь.\n" +
                        "2. Определи itemId этого блюда.\n" +
                        "3. Определи sizeId выбранного размера. Если размер не указан или не найден, верни null.\n\n" +
                        "Ответ должен быть ТОЛЬКО в JSON формате, без пояснений, без текста, без примечаний.\n" +
                        "Структура JSON:\n" +
                        "{\n" +
                        "  \"itemId\": \"string или null\",\n" +
                        "  \"sizeId\": \"string или null\"\n" +
                        "}\n\n" +
                        "Пример:\n" +
                        "{\n" +
                        "  \"itemId\": \"568134e2-883e-4668-82e2-3dde9fb28bf4\",\n" +
                        "  \"sizeId\": \"16034385-a22b-47c7-8c43-bba2696b65c6\"\n" +
                        "}\n\n" +
                        "Если блюдо не найдено, верни null для itemId.\n" +
                        "Если размер не найден или не указан, верни null для sizeId.\n",
                menu
        );
    }

    public static String BuildPromptForInvalidRemoveItem(String menu) {
        return String.format(
                "Пользователь хочет удалить блюдо из корзины. " +
                        "Проанализируй текст пользователя и сопоставь его с блюдами из меню, чтобы определить itemId и sizeId.\n\n" +
                        "Меню:\n%s\n\n" +
                        "Твоя задача:\n" +
                        "1. Найди блюдо, которое написал пользователь.\n" +
                        "2. Определи itemId этого блюда.\n" +
                        "3. Определи sizeId выбранного размера. Если размер не указан или не найден, верни null.\n\n" +
                        "Ответ должен быть ТОЛЬКО в JSON формате, без текста, без пояснений.\n" +
                        "Структура JSON:\n" +
                        "{\n" +
                        "  \"itemId\": \"string или null\",\n" +
                        "  \"sizeId\": \"string или null\"\n" +
                        "}\n\n" +
                        "Пример:\n" +
                        "{\n" +
                        "  \"itemId\": \"568134e2-883e-4668-82e2-3dde9fb28bf4\",\n" +
                        "  \"sizeId\": \"16034385-a22b-47c7-8c43-bba2696b65c6\"\n" +
                        "}\n\n" +
                        "Если блюдо не найдено, верни null для itemId.\n" +
                        "Если размер не найден или не указан, верни null для sizeId.\n",
                menu
        );
    }

    public static String BuildPromptMappingCommand() {
        return """
            Ты - интеллектуальный ассистент ресторана, который анализирует запросы гостей и определяет их намерения.
            
            ТВОЯ ЗАДАЧА:
            Проанализировать текст пользователя и вернуть структурированный JSON с намерением и сущностями.
            
            ДОСТУПНЫЕ НАМЕРЕНИЯ (intents):
            - ADD_ITEM: добавить блюдо в заказ
            - REMOVE_ITEM: удалить блюдо из заказа
            - CHANGE_QUANTITY: изменить количество блюда
            - SHOW_MENU: показать меню
            - SHOW_CART: показать текущий заказ
            - CHECKOUT: оформить заказ
            - CALL_WAITER: позвать официанта
            - REQUEST_BILL: попросить счет
            - UNKNOWN: неизвестное намерение
            
            ФОРМАТ ОТВЕТА (строго JSON):
            {
              "intent": "название_намерения",
              "confidence": 0.95,
              "entities": {
                "dish_name": "название блюда",
                "quantity": 2
              },
              "response": "Ответ пользователю"
            }
            
            ВАЖНО: Возвращай ТОЛЬКО валидный JSON, без дополнительного текста.
            
            """;
    }

    public static String buildPromptForDishRecognition(String menu, String userText) {
        return """
        Пользователь хочет получить подробную информацию о блюде.
        Определи, какое именно блюдо имеется в виду, используя меню.

        Меню:
        %s

        Текст пользователя:
        "%s"

        Твоя задача:
        1. Найди блюдо, наиболее соответствующее запросу пользователя.
        2. Верни только JSON в формате:
        {
          "itemId": "string или null"
        }

        Если блюдо не найдено — верни:
        {
          "itemId": null
        }

        Никаких пояснений, примечаний и текста — только JSON.
        """.formatted(menu, userText);
    }

}
